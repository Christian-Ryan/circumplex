---
title: "Apply the Structural Summary Method"
author: "Jeffrey M. Girard"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Apply the Structural Summary Method}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
library(circumplex)
library(ggplot2)
library(ggforce)
library(tibble)
library(kableExtra)
```

Circumplex (i.e., circular) models of affect and interperpersonal functioning
are popular within personality, social, and clinical psychology. The Structural
Summary Method (SSM) is a technique for analyzing circumplex data that offers
practical and interpretive benefits over alternative techniques. See Wright et
al. (2009) for an accessible introduction to the SSM and Gurtman (1992), Gurtman
& Pincus (2003), and Zimmermann & Wright (2017) for more in-depth discussions.

The `circumplex` package offers a suite of functions for performing different
types of SSM analyses and visualizing their results in tables and figures. This
vignette will assume that users understand how the SSM works and will focus on
walking users through applying it using the relevant `circumplex` functions.

## Data: jz2017

To illustrate the SSM functions, we will use the example dataset `jz2017`, which
was provided by Zimmermann & Wright (2017) and reformatted for this package.
This dataset includes self-report data from 1166 undergraduate students.
Students completed a circumplex measure of interpersonal problems with eight 
subscales (PA, BC, DE, FG, HI, JK, LM, and NO) and a measure of personality
disorder symptoms with ten subscales (PARPD, SCZPD, SZTPD, ASPD, BORPD, HISPD,
NARPD, AVPD, DPNPD, and OCPD). More information about these variables can be
accessed using the `?jz2017` command in R.

```{r}
data("jz2017")
jz2017
```

The circumplex scales in `jz2017` come from the Inventory of Interpersonal
Problems - Short Circumplex. These scales can be arranged into the
following circular model, which is organized around the two primary dimensions
of agency (y-axis) and communion (x-axis). Note that the two-letter scale 
abbreviations and angular values are based in convention. A high score on PA
indicates that one has interpersonal problems related to being "domineering" or
too high on agency, whereas a high score on DE indicates problems related to 
being "cold" or too low on communion. Scales that are not directly on the y-axis
or x-axis (i.e., BC, FG, JK, and NO) represent blends of agency and communion.

```{r, echo = FALSE, fig.width = 7.2, fig.height = 4}
angles <- c(90, 135, 180, 225, 270, 315, 360, 45)
flabel <- c(
  "Domineering", 
  "Vindictive", 
  "Cold", 
  "Socially\nAvoidant", 
  "Nonassertive", 
  "Easily\nExploited", 
  "Overly\nNurturant", 
  "Intrusive")
alabel <- c("PA", "BC", "DE", "FG", "HI", "JK", "LM", "NO")

# Create plot ------------------------------------------------------------------

ggplot() +
  # Require plot to be square and remove default styling
  coord_fixed() +
  theme_void() +
  # Expand both axes multiplicatively to fit the labels
  scale_x_continuous(expand = c(0.30, 0)) +
  scale_y_continuous(expand = c(0.10, 0)) +
  # Draw line segments corresponding to the octants
  geom_segment(
    aes(
      x = 0,
      y = 0,
      xend = 5 * cos(angles * pi / 180),
      yend = 5 * sin(angles * pi / 180)
    ),
    color = "gray60",
    size = 0.5
  ) +
  # Draw inner labels for the octant abbreviations
  geom_label(
    aes(
      x = 3.75 * cos(angles * pi / 180),
      y = 3.75 * sin(angles * pi / 180),
      label = alabel
    ),
    size = 5,
    color = "gray40",
    label.size = NA,
    hjust = "center",
    vjust = "center"
  ) +
  # Draw inner labels for the octant angles
  geom_label(
    aes(
      x = 2 * cos(angles * pi / 180),
      y = 2 * sin(angles * pi / 180),
      label = sprintf("%d\u00B0", angles)
    ),
    size = 4,
    color = "gray50",
    label.size = NA,
    hjust = "center",
    vjust = "center"
  ) +
  # Draw the circle
  geom_circle(aes(x0 = 0, y0 = 0, r = 5),
    color = "gray50", size = 1.5
  ) +
  # Draw outer labels for the octant names
  geom_label(
    aes(
      x = 5.1 * cos(angles * pi / 180),
      y = 5.1 * sin(angles * pi / 180),
      label = flabel
    ),
    size = 5,
    color = "black",
    label.size = NA,
    hjust = "outward",
    vjust = "outward"
  )
```

## Overview of the SSM functions

The `circumplex` package currently provides three primary SSM-related functions:

* `ssm_analyze()` takes in tidy data and outputs an ssm results object

* `ssm_table()` takes in an ssm results object and outputs an HTML table

* `ssm_plot()` takes in an ssm results object and outputs a figure object

The fact that the output of `ssm_analyze()` is the input of the other functions
allows for a convenient flow of data through the function pipeline and reduces
the need for reformatting or transforming data for different purposes.

## A taxonomy of SSM analyses

Although all SSM analyses are based on the idea of decomposing circumplex scores
into the parameters of a cosine curve, there are actually many different ways to
implement it. Each of these implementations allows different questions to be
explored. In the table below, a list of the SSM analysis types that are 
currently implemented in the `circumplex` package is provided. This table also
provides the specific combination of arguments needed to implement each analysis
using the `ssm_analyze()` function. Specifying which analysis to run is simply 
a matter of providing the correct arguments to the function; this allows a 
single function to essentially do the work of seven and makes for a more 
intuitive user experience.

```{r, echo = FALSE}
msr <- c("FALSE", "FALSE", "FALSE", "TRUE",  "TRUE",  "TRUE",  "TRUE")
grp <- c("FALSE", "TRUE",  "TRUE",  "FALSE", "FALSE", "TRUE",  "TRUE")
ctr <- c("FALSE", "FALSE", "TRUE",  "FALSE", "TRUE",  "FALSE", "TRUE")
tab <- tibble(
  `#` = c(1, 2, 3, 4, 5, 6, 7),
  Usage = c(
    "Examine overall mean profile",
    "Examine groups' mean profiles",
    "Compare groups' mean profiles",
    "Examine variables' correlation profiles",
    "Compare variables' correlation profiles",
    "Examine groups' correlation profiles",
    "Compare groups' correlation profiles"
  ),
  measures = cell_spec(msr, color = ifelse(msr == "TRUE", "blue", "black")),
  grouping = cell_spec(grp, color = ifelse(grp == "TRUE", "blue", "black")),
  contrast = cell_spec(ctr, color = ifelse(ctr == "TRUE", "blue", "black"))
)
knitr::kable(tab, escape = FALSE) %>% 
  column_spec(2, width = "3in") %>% 
  add_header_above(c("", "", "Arguments Needed" = 3))
```

The three main questions to ask when conducting a new SSM analysis are:

1. **Do we want to project non-circumplex measures into the circumplex space?**
If yes, we must specify one or more `measures`, and the scores that get modeled 
using SSM will be the correlations between the circumplex scales and these
measures. If no, we must omit the `measures` argument, and the scores that get
modeled using SSM will be the mean scores on the circumplex scales.

1. **Do we want to perform analyses separately for groups within the dataset?**
If yes, we must specify a `grouping` variable, and the output will contain
results for each group (i.e., unique value of this variable). If no, we must
omit the `grouping` argument, and a single set of results for all data will be
output.

1. **Do we want to contrast/compare two sets of results?** If yes, we must
specify a `contrast` type (i.e., "model" or "test") and ensure that we are only
requesting two sets of results (i.e., two groups or two measures). If no, we
must omit the `contrast` argument, and the results themselves will be output,
rather than their contrast.

## Analysis Type #1: Examine overall mean profile

To begin, let's say that we want to use the SSM to describe the interpersonal 
problems of the average individual in the entire dataset. If we ask the three
questions above, we get three answers of "no," which leaves us with analysis
type #1. Now we can use the `ssm_analyze()` function to perform the desired SSM
analysis without needing any additional arguments. The first argument is always
`.data`, a data frame containing all the variables to be analyzed. The second
argument is always `scales` and specifies where in `.data` the circumplex scales
are (either in terms of their variable names or their column numbers). The third
argument is always `angles` and specifies the angular displacements of each of
the  circumplex scales included in `scales`. The order and length of the
`scales` and `angles` arguments should be the same.

```{r}
results <- ssm_analyze(.data = jz2017,
  scales = c(PA, BC, DE, FG, HI, JK, LM, NO),
  angles = c(90, 135, 180, 225, 270, 315, 360, 45))
```

The output of the function has been saved in the `results` variable, which we 
can examine in detail using the `summary()` function. This will output the call
we made to create the output, as well as some of the default options that we
didn't bother changing and, most importantly, the estimated SSM parameter values
with bootstrapped confidence intervals.

```{r}
summary(results)
```

That was pretty easy! We can now write up these results. However, the
`circumplex` package has some features that can make what we just did even 
easier, and can also make the write-up process easier by generating tables and
figures for us. First, because the first three arguments of the `ssm_analyze()`
function are always the same, we can omit their names. Second, because we 
organized the `jz2017` data frame to have the circumplex scale variables
adjacent and in order from PA to NO, we can simplify their specification by 
using the `PA:NO` shortcut. Finally, because the use of octant scales is so 
common, the `circumplex` package comes with a convenience function for outputing
their angular displacements: `octants()`. Note how, even when using these
shortcuts, the results are identical.

```{r}
results2 <- ssm_analyze(jz2017, PA:NO, octants())
summary(results2)
```

Next, we can produce a table to display our results. With only a
single set of parameters, this table is probably overkill, but in future
analyses we will see how this function saves a lot of time and effort. To create
the table, simply pass the `results` object to the `ssm_table()` function.

```r
ssm_table(results)
```

```{r, echo = FALSE}
ssm_table(results, tibble = TRUE) %>%
  kable() %>% 
  kable_styling()
```

On this screen, the numbers don't fit perfectly, so let's free up some
horizontal space by omitting the X-Value and Y-Value columns.

```r
ssm_table(results, xy = FALSE)
```

```{r, echo = FALSE}
ssm_table(results, xy = FALSE, tibble = TRUE) %>%
  kable() %>% 
  kable_styling()
```

Next, let's leverage the fact that we are working within a circumplex space by
creating a nice-looking circular plot with the amplitude parameter as the
points' distance from the center of the circle and the displacement parameter
as the points' rotation from due-east (as is convention). This, again, is as 
simple as passing the `results` object to the `ssm_plot()` function.

```{r, fig.width = 7.2, fig.height = 4}
ssm_plot(results)
```

Very cool! 

## References
* Gurtman, M. B. (1992). Construct validity of interpersonal personality measures: The interpersonal circumplex as a nomological net. _Journal of Personality and Social Psychology, 63_(1), 105–118.

* Gurtman, M. B., & Pincus, A. L. (2003). The circumplex model: Methods and research applications. In J. A. Schinka & W. F. Velicer (Eds.), _Handbook of psychology. Volume 2: Research methods in psychology_ (pp. 407–428). Hoboken, NJ: John Wiley & Sons, Inc.

* Wright, A. G. C., Pincus, A. L., Conroy, D. E., & Hilsenroth, M. J. (2009). Integrating methods to optimize circumplex description and comparison of groups. _Journal of Personality Assessment, 91_(4), 311–322.

* Zimmermann, J., & Wright, A. G. C. (2017). Beyond description in interpersonal construct validation: Methodological advances in the circumplex Structural Summary Approach. _Assessment, 24_(1), 3–23.